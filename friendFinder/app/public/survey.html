<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Friend Finder</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" integrity="sha384-zF4BRsG/fLiTGfR9QL82DrilZxrwgY/+du4p/c7J72zZj+FLYq4zY00RylP9ZjiT"
        crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container">
        <h1>Survey</h1>
        <hr>
        <form class="form">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id='name' required>
            </div>
            <div class="form-group">
                <label for="image">image url</label>
                <input type="text" class="form-control" id='image' required>
            </div>
            <hr>
            <h2>On a scale of one to five how much do you agree?five being you agree.</h2>
            <div class="form-group">
                <label for='q1' class='lead'>Do you nerd out on things you like? </label>
                <select id='q1' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label for='q2' class='lead'>Do you like pushing your limits? </label>
                <select id='q2' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label for='q3' class='lead'>Do you enjoy driving around with the windows down and loud music? </label>
                <select id='q3' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label for='q4' class='lead'>Can you just sit in a room with your friend in silence n still feel like youre bonding? </label>
                <select id='q4' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label for='q5' class='lead'>Would you utilize party drugs? </label>
                <select id='q5' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label for='q6' class='lead'>Do you take pinkie promises seriously? </label>
                <select id='q6' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label for='q7' class='lead'>Have you ever had a friend with benefits? </label>
                <select id='q7' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label for='q8' class='lead'>Have you ever wanted to run away? </label>
                <select id='q8' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label for='q9' class='lead'>Wanna go get late night pancakes?</label>
                <select id='q9' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label for='q10' class='lead'>Can you keep a secret? </label>
                <select id='q10' class="form-control" required>
                    <option value="" selected disabled>please select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <br>
            <button type="button" id='submit' class="btn btn-success btn-lg btn-block" data-toggle="modal" data-target="#modal">
                <i class="fa fa-check-square" aria-hidden='true'></i>Submit</button>
        </form>
        <br/>
        <footer class="footer">
            <div class="container">
                <p>
                    <a href="/api/friends" target="_blank>API Friends lists">API friends list</a>|
                    <a href="https://github.com/geina17/foreverAloneApp" target='_blank'>github</a>
                </p>
            </div>
        </footer>
    </div>
    <div class="modal fade" id='modal' role="dialog">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss='modal'>&times;</button>
                    <h4 class='modal-title'>Meet your new beastie!</h4>
                </div>
                <div class="modal-body">
                    <h1 id="matchName"> </h1>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        //set up global vars
        var name, image, q1, q2, q3, q4, q5, q6, q7, q8, q9, q10, noob;

        $('#submit').on('click', function (event) {
            event.preventDefault();

            function validation(){
                var isVal = true;
                $('.form-control').each(function(){
                    if($(this).val()===''){
                        isVal = false;
                    }
                });
                return isVal;
            }
            

            if (validation()){
                //set vars
                var userData = {
                    name : $('#name').val(),
                    image: $('#image').val(),
                    score: [
                        $('#q1').val(),
                        $('#q2').val(),
                        $('#q3').val(),
                        $('#q4').val(),
                        $('#q5').val(),
                        $('#q6').val(),
                        $('#q7').val(),
                        $('#q8').val(),
                        $('#q9').val(),
                        $('#q10').val()
                    ]
                };
                //location of root pg
                var crntURL = windows.location.origin;
                $.post(crntURL + '/api/friends', userData)
                    .then(function (data) {
                        $(".form-control").val("");
                        $(".chosen-select").val("");
                        $('#matchName').text(data.name)
                    });
                //ajax uses the url of api to get the data associated w/it
                $.ajax({ 
                    url: crntURL + '/api/friends', 
                    method: 'GET' 
                }).done(function (res) {
                    var bstMatch;
                    var quizDiff = [];
                    var vArray = [];

                    //loop thro each survey
                    for (var i = 0; i < res.length - 1; i++) {
                        for (var j = 0; j < 10; j++) {
                            var qDiff = userData.scores[j] - res[i].scores[j];
                            quizDiff.push(Math.abs(qDiff))
                        }
                        var totDiff = quizDiff.reduce(getSum);
                        console.log('quizDiff:' + quizDiff);
                        console.log('totDiff:' + totDiff);

                        //get sum of q differ for ech survey
                        quizDiff = [];

                        //stores all sums in a new array
                        vArray.push(totDiff);
                        console.log(vArray);
                        //find min sum diff
                        function min(vArray){
                            if(vArray ===0){
                                return -1;
                            }
                            var mini =varianceArray[0];
                            var index =0;
                            for (var i=1;i<vArray.length;i++){
                                if(vArray[i]<min){
                                    index =i;
                                    mini=varianceArray[i];
                                }
                            }
                            console.log('index'+index);
                            console.log(res[parseInt(index)].name);
                            bstMatch =res[parseInt(index)].name;
                            console.log('bestmatch'+bstMatch);
                        }
                    }
                    //call function
                    min(vArray);
                    //send results
                    var matchPix = '<img width="300px"src='+ matchPix+'>';
                    $(".modal-title").html();
                    $(".modal-body").html(bestMatchPic + "<br>" + "<h3><i>" + '"' + bestMatchQuote + '"' + "</i></h3>");
                    $("#matchModal").modal('show');
                });
            }else{
                alert('please fill out all fields');
            };
            function getSum(total,num){
                return total+num;
            };
        });
    </script>
</body>

</html>